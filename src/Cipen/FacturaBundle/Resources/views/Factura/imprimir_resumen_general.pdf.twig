<html>
    <head>
        <link type="text/css" rel="media"
              href="{{ asset('bundles/comuncomun/css/factura-pdf.css') }}" />
    </head>

    <body>

    {% for facturaInternacion in facturaInternaciones %}
        
       <div class="titulo">{{ factura.obraSocial is not empty ? "Obra social "~factura.obraSocial : "Sin obra social" }}</div>
        {% set internacion = facturaInternacion.internacion %}

            <table class="table table-align-left">
                <thead>
                    <tr>
                        <th  width="25%">Periodo: {{ periodo }}</th>
                        <th  width="25%">Historia clínica n°: {{ internacion.numero }} </th>
                        <th  width="49%"></th>
                    </tr>
                    <tr>
                        <th >
                           {% if factura.obraSocial is not empty %}
                                Afiliado n°: {{ internacion.numeroObraSocialPaciente  }} 
                           {% else %}
                                Paciente n°: {{ internacion.paciente.numero  }} 
                           {% endif %}
                        </th>
                        <th >DNI: {{ internacion.paciente.dni }}</th>
                        <th >
                            Apellido, nombre: {{ internacion.paciente.apellido~", "~internacion.paciente.nombre }}
                        </th>
                    </tr>
                    <tr>
                        <th >Fecha de ingreso: {{ internacion.fechaHoraIngreso | date('d/m/Y') }}</th>
                        <th >Fecha de egreso: {{ internacion.fechaHoraIngreso | date('d/m/Y') }} </th>
                        <th ></th>                
                    </tr>
              </thead>
            </table>
            {{ _self.internacion(facturaInternacion.internacion,prestaciones,tipo_total) }}
        
        {% if loop.last != true %}
            <pagebreak type="NEXT-ODD" resetpagenum="1" pagenumstyle="i" suppress="off" />
         {% endif %}
    {% endfor %}
    
    {% macro internacion (internacion,prestaciones,tipo_total) %}
        
        <table class="table-bordered" >
            <thead>
                <tr>
                    <th  width="30">Cant.</th>
                    <th width="100">Código</th>
                    <th class="text-left" width="{{ tipo_total == "porcentaje_10_90" ? "330" : "410" }}">Descripción</th>
                    <th width="100">Mat. prof.</th>
                    {% if tipo_total == "porcentaje_10_90" %}
                        <th width="80">90%</th>
                        <th width="80">10%</th>
                    {% else %}
                        <th width="80">Val. unit.</th>
                   {% endif %}
                    <th width="80">Total</th>
                </tr>
            </thead>
            <tbody>

            {% set totalSum = 0 %}
            {% set diezPorcentSum = 0 %}
            {% set noventaPorcentSum = 0 %}
            {% set valorUnitarioSum = 0 %}
            
            {% for prestacion in prestaciones[internacion.id] %}
            
                
                {% set totalSum = totalSum + prestacion.total %}
                {% set valorUnitarioSum = valorUnitarioSum + prestacion.valor_unitario %}
                {% if tipo_total == "porcentaje_10_90" %}
                    {% set diezPorcentSum = diezPorcentSum + prestacion.porcentaje_10 %}
                    {% set noventaPorcentSum = noventaPorcentSum + prestacion.porcentaje_90 %}            
                {% endif %}
    
                <tr>
                    <td align="center">{{ prestacion.cantidad }}</td>
                    <td align="center" >{{ prestacion.tipo == "modulo" ?  prestacion.object.codigo : prestacion.object.acto.codigo }}</td>
                    <td>
                        {{ prestacion.tipo == "modulo" ?  prestacion.object.descripcion : prestacion.object.acto.descripcion }}
                    </td>
                    <td align="center">{{ internacion.prescriptor.matricula }}</td>
                    
                    {% if tipo_total == "porcentaje_10_90" %}
                        <td align="center">$ {{ prestacion.porcentaje_90 }}</td>
                        <td align="center">$ {{  prestacion.porcentaje_10 }}</td>
                     {% else %}
                        <td align="center">$ {{  prestacion.valor_unitario }}</td>
                     {% endif %}
                    <td align="center">$ {{ prestacion.total }}</td>                    
                </tr>
            {% endfor %}
            </tbody>
        </table>
        
        <table class="table-bordered" align="right" style="width:{{ tipo_total == "porcentaje_10_90" ? "300" : "230" }}px">
            <thead>
                <tr>
                    <th width="100">Totales</th>
                    {% if tipo_total == "porcentaje_10_90" %}
                        <th width="67">$ {{noventaPorcentSum}}</th>
                        <th width="67">$ {{ diezPorcentSum }}</th>
                    {% else %}
                        <th width="67">$ {{ valorUnitarioSum }}</th>
                    {% endif %}
                    <th width="67   ">$ {{totalSum}}</th>
                </tr>
            </thead>
        </table>

    
    {% endmacro %}

    </body>
</html>